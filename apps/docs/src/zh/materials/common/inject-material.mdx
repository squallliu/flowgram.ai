import { SourceCode } from '@theme';

# ç‰©æ–™ç»„ä»¶ä¾èµ–æ³¨å…¥

:::tip{title="ç›®å‰ç‰©æ–™åº“ä¸­æ”¯æŒä¾èµ–æ³¨å…¥çš„ç»„ä»¶ç‰©æ–™"}

- [InjectDynamicValueInput](../components/dynamic-value-input)
- [InjectTypeSelector](../components/type-selector)
- [InjectVariableSelector](../components/variable-selector)

:::

## èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆç‰©æ–™åº“éœ€è¦ä¾èµ–æ³¨å…¥ ?

### âŒ ç´§è€¦åˆï¼šä¼ ç»Ÿä¾èµ–é—®é¢˜

```mermaid
graph TD
    A[ç‰©æ–™ A] --> B[ç‰©æ–™ B]
    B --> D[ç‰©æ–™ D]
    C[ç‰©æ–™ C] --> D

    style D fill:#ff4757
    style A fill:#ffa502
    style B fill:#ffa502
    style C fill:#ffa502

    note["ğŸ’¥ é—®é¢˜ï¼šDå˜æ›´å¯¼è‡´Aã€Bã€Cå…¨éƒ¨éœ€è¦ä¿®æ”¹"]
```

**é—®é¢˜ï¼š** è¿é”ååº”ã€é«˜ç»´æŠ¤æˆæœ¬

### âœ… è§£è€¦ï¼šä¾èµ–æ³¨å…¥æ–¹æ¡ˆ

```mermaid
graph TD
    A[ç‰©æ–™ A] --> RenderKey[ç‰©æ–™ D RenderKey]
    B[ç‰©æ–™ B] --> RenderKey
    C[ç‰©æ–™ C] --> RenderKey

    RenderKey -.-> BaseD[é»˜è®¤ç‰©æ–™ D]
    CustomD[è‡ªå®šä¹‰ç‰©æ–™ D] -.-> RenderKey

    style RenderKey fill:#3498db
    style BaseD fill:#2ed573
    style CustomD fill:#26d0ce
    style A fill:#a55eea
    style B fill:#a55eea
    style C fill:#a55eea

    note2["âœ… Aã€Bã€Cä¾èµ–æŠ½è±¡æ¥å£ï¼Œä¸Då®ç°è§£è€¦"]
```

**ä¼˜åŠ¿ï¼š** çƒ­æ’æ‹”ã€å¹¶è¡Œå¼€å‘ã€ç‰ˆæœ¬å…¼å®¹

## ä½¿ç”¨æ–¹å¼

### åˆ›å»ºå¯æ³¨å…¥çš„ç»„ä»¶ç‰©æ–™

```tsx
import { createInjectMaterial } from '@flowgram.ai/form-materials';
import { VariableSelector } from './VariableSelector';

// ä½¿ç”¨ createInjectMaterial é«˜é˜¶ç»„ä»¶åŒ…è£…ç»„ä»¶
const InjectVariableSelector = createInjectMaterial(VariableSelector);

// ç°åœ¨ä½ å¯ä»¥åƒä½¿ç”¨æ™®é€šç»„ä»¶ä¸€æ ·ä½¿ç”¨å®ƒ
function MyComponent() {
  return <InjectVariableSelector value={value} onChange={handleChange} />;
}
```

### æ³¨å†Œè‡ªå®šä¹‰ç»„ä»¶

ä¸€ä¸ªç»„ä»¶ç‰©æ–™å¹¶åˆ›å»ºä¸ºå¯æ³¨å…¥çš„ç‰©æ–™ç»„ä»¶ï¼Œå½“è¢«å…¶ä»–ç‰©æ–™ä½¿ç”¨æ—¶å€™ï¼Œå¯ä»¥åœ¨ `use-editor-props.tsx` ä¸­æ³¨å…¥è¯¥ç‰©æ–™çš„è‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼š

```tsx
import { useEditorProps } from '@flowgram.ai/editor';
import { YourCustomVariableSelector } from './YourCustomVariableSelector';
import { VariableSelector } from '@flowgram.ai/form-materials';

function useCustomEditorProps() {
  const editorProps = useEditorProps({
    materials: {
      components: {
        // é»˜è®¤ä½¿ç”¨ç»„ä»¶çš„ Function Name ä½œä¸º renderKey
        'VariableSelector': YourCustomVariableSelector,
        'TypeSelector': YourCustomTypeSelector,
      }
    }
  });

  return editorProps;
}
```

### ä½¿ç”¨è‡ªå®šä¹‰ renderKey

å¦‚æœä½ çš„ç»„ä»¶éœ€è¦ç‰¹å®šçš„ renderKeyï¼š

**æ–¹æ³• 1ï¼š** é€šè¿‡ createInjectMaterial çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®š renderKey

```tsx
const InjectCustomComponent = createInjectMaterial(MyComponent, {
  renderKey: 'my-custom-key'
});
// æ³¨å†Œæ—¶
{
  materials: {
    components: {
      'my-custom-key': MyCustomRenderer
    }
  }
}
```

**æ–¹æ³• 2ï¼š** æˆ–è€…ç›´æ¥è®¾ç½®ç»„ä»¶çš„ renderKey å±æ€§

```tsx
MyComponent.renderKey = 'my-custom-key';
const InjectCustomComponent = createInjectMaterial(MyComponent);
// æ³¨å†Œæ—¶
{
  materials: {
    components: {
      [MyComponent.renderKey]: MyCustomRenderer
    }
  }
}

```


:::note{title="æ¸²æŸ“é”®ä¼˜å…ˆçº§"}

ç»„ä»¶æ¸²æŸ“é”®çš„ç¡®å®šéµå¾ªä»¥ä¸‹ä¼˜å…ˆçº§é¡ºåºï¼š

1. `params.renderKey` (createInjectMaterial çš„ç¬¬äºŒä¸ªå‚æ•°)
2. `Component.renderKey` (ç»„ä»¶è‡ªèº«çš„ renderKey å±æ€§)
3. `Component.name` (ç»„ä»¶çš„æ˜¾ç¤ºåç§°)
4. ç©ºå­—ç¬¦ä¸² (æœ€ç»ˆå›é€€)

:::

## API å‚è€ƒ

```typescript
interface CreateInjectMaterialOptions {
  renderKey?: string;
}

function createInjectMaterial<Props>(
  Component: React.FC<Props> & { renderKey?: string },
  params?: CreateInjectMaterialOptions
): React.FC<Props>
```

## æºç å¯¼è¯»

<SourceCode
  href="https://github.com/bytedance/flowgram.ai/blob/main/packages/materials/form-materials/src/shared/inject-material/index.tsx"
/>

ä½¿ç”¨ CLI å‘½ä»¤å¯ä»¥å¤åˆ¶æºä»£ç åˆ°æœ¬åœ°ï¼š

```bash
npx @flowgram.ai/cli@latest materials shared/inject-material
```

### æ ¸å¿ƒæ—¶åºå›¾

å®Œæ•´çš„ç»„ä»¶æ³¨å†Œå’Œæ¸²æŸ“æ—¶åºå›¾ï¼š

```mermaid
sequenceDiagram
    participant App as åº”ç”¨ç¨‹åº
    participant Editor as use-editor-props
    participant Registry as FlowRendererRegistry
    participant Inject as InjectMaterial
    participant Default as é»˜è®¤ç»„ä»¶
    participant Custom as è‡ªå®šä¹‰ç»„ä»¶

    Note over App,Custom: ç»„ä»¶æ³¨å†Œé˜¶æ®µ
    App->>Editor: è°ƒç”¨ use-editor-props()
    Editor->>Editor: é…ç½® materials.components
    Editor->>Registry: å‘ FlowRendererRegistry æ³¨å†Œç»„ä»¶
    Registry->>Registry: å­˜å‚¨æ˜ å°„å…³ç³»
    Registry-->>App: æ³¨å†Œå®Œæˆ

    Note over App,Custom: ç»„ä»¶æ¸²æŸ“é˜¶æ®µ
    App->>Inject: æ¸²æŸ“ InjectMaterial ç»„ä»¶
    Inject->>Registry: æŸ¥è¯¢æ¸²æŸ“å™¨ (getRendererComponent)

    alt å­˜åœ¨è‡ªå®šä¹‰æ¸²æŸ“å™¨
        Registry-->>Inject: è¿”å›è‡ªå®šä¹‰ React ç»„ä»¶
        Inject->>Custom: ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶æ¸²æŸ“
        Custom-->>App: æ¸²æŸ“è‡ªå®šä¹‰ UI
    else æ— è‡ªå®šä¹‰æ¸²æŸ“å™¨
        Registry-->>Inject: è¿”å› null æˆ–ç±»å‹ä¸åŒ¹é…
        Inject->>Default: ä½¿ç”¨é»˜è®¤ç»„ä»¶æ¸²æŸ“
        Default-->>App: æ¸²æŸ“é»˜è®¤ UI
    end
```
